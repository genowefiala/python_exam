import os 

def aggregator():
        directory = "aggregated"
        txt_list = []
        items = os.listdir(".")

        print"Parsing result files in current directory...",
        print" done"

#creating directory aggregated
        if os.path.isdir(directory):
                print"Directory exists"
        else:
                print "Creating directory 'aggregated'...",
                os.makedirs(directory)
                print" done."


#listing IP addresses 
        print "IP addresses encountered:"

        IPS = set()
        for files in items: 
                if files.endswith(".txt"):
                        txt_list.append(files)
                        file_split = files.split("_")
                        IPS.add(file_split[0])

        for each in IPS:
                print "-" + each

#Matching IP to file s containing that IP

        IP_files = {}
        for IP in IPS:
                IP_files[IP]=[]
                for fname in items:
                        if fname.startswith(IP):
                                IP_files[IP].append(fname)           
                                
#writing to one file  
        for key,value in IP_files.iteritems():
                with open("./aggregated/" + key + ".txt", "w") as outfile:
                        for filename in value:
                                with open(filename) as infile:
                                        outfile.write(infile.read())
        print "Writing combined dataset to ./aggregated/" + key + ".txt" 
        print "Aggregation completed!"

aggregator()

